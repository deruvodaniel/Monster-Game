<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vue Basics</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js" defer></script>
    <script src="app.js" defer></script>
  </head>
  <body>
    <div id="game">
      <header class="app-header">
        <h1>Monster Slayer</h1>
        <div class="header-actions">
          <!-- Player Info -->
          <div v-if="playerName && started" class="player-info" @click="openUserMenu" role="button" :aria-label="lang === 'es' ? 'Abrir menÃº de usuario' : 'Open user menu'">
            <img v-if="selectedCharacter" :src="selectedCharacter.image" :alt="selectedCharacter.name[lang]" class="player-avatar-header" />
            <div class="player-details">
              <span class="player-name-header">{{ playerName }}</span>
              <span class="player-coins numeric">ğŸª™ {{ playerCoins }}</span>
            </div>
          </div>
          <span class="lives-badge numeric" aria-label="lives">â¤ï¸ Ã— {{ lives }}</span>
          <div class="lang-group">
            <button class="lang-btn" :class="{ active: lang==='es' }" @click="setLang('es')">ES</button>
            <button class="lang-btn" :class="{ active: lang==='en' }" @click="setLang('en')">EN</button>
          </div>
          <button class="icon-button" @click="toggleSound" :aria-label="t('soundToggle')">{{ soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡' }}</button>
          <button class="icon-button theme-icon" @click="toggleTheme" :aria-label="t('themeToggle')">{{ theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™' }}</button>
          <button class="icon-button" @click="openHelp" :aria-label="t('howToPlay')">â„¹ï¸</button>
        </div>
        <!-- Mobile settings toggle and panel -->
        <button class="mobile-settings-toggle" @click="toggleMobileSettings" aria-label="Settings">âš™ï¸</button>
        <div class="mobile-settings-overlay" :class="{ open: showMobileSettings }" @click="showMobileSettings = false"></div>
        <div class="mobile-settings-panel" :class="{ open: showMobileSettings }">
          <div class="lang-group">
            <button class="lang-btn" :class="{ active: lang==='es' }" @click="setLang('es')">ES</button>
            <button class="lang-btn" :class="{ active: lang==='en' }" @click="setLang('en')">EN</button>
          </div>
          <button v-if="playerName && started" class="icon-button" @click="openUserMenu" data-label="Perfil">ğŸ‘¤</button>
          <button class="icon-button" @click="toggleSound" data-label="Sonido">{{ soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡' }}</button>
          <button class="icon-button theme-icon" @click="toggleTheme" data-label="Tema">{{ theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™' }}</button>
          <button class="icon-button" @click="openHelp" data-label="Ayuda">â„¹ï¸</button>
        </div>
      </header>
      <section v-if="!started" id="landing" class="landing-root">
        <h2>{{ t('welcome') }}</h2>
        <p class="welcome-msg">{{ t('welcomeMsg') }}</p>
        <div class="character-select">
          <h3 class="select-title">{{ t('chooseCharacter') }}</h3>
          <div class="characters-grid">
            <button
              v-for="char in characters"
              :key="char.id"
              type="button"
              class="character-card"
              :class="{ 'is-selected': selectedCharacterId === char.id }"
              @click="selectCharacter(char.id)"
            >
              <div class="flip-inner">
                <div class="card-face card-face--front">
                  <img :src="char.image" :alt="char.name[lang]" class="char-img char-img--full gray-image" />
                  <div class="card-title-overlay">{{ char.icon }} {{ char.name[lang] }}</div>
                </div>
                <div class="card-face card-face--back" aria-hidden="true">
                  <img :src="char.image" :alt="char.name[lang]" class="char-img char-img--full" />
                  <div class="skills-overlay">
                    <h4 class="char-name">{{ char.icon }} {{ char.name[lang] }}</h4>
                    <ul class="char-stats">
                      <li>âš”ï¸ {{ t('attack') }}: {{ char.stats.attack }}</li>
                      <li>ğŸ›¡ï¸ {{ t('defend') }}: {{ char.stats.defend }}</li>
                      <li>ğŸ’š {{ t('heal') }}: {{ char.stats.heal }}</li>
                      <li>ğŸ’¥ {{ t('special') }}: {{ char.stats.special }}</li>
                    </ul>
                  </div>
                </div>
              </div>
            </button>
          </div>
        </div>
        <button :disabled="!selectedCharacterId" @click="startGame">{{ t('start') }}</button>
      </section>

      <!-- Map Progress Screen -->
      <section v-else-if="showMapScreen" class="map-screen">
        <div class="map-container">
          <h2 class="map-title">{{ lang === 'es' ? 'Tu Progreso' : 'Your Progress' }}</h2>
          <div class="map-path">
            <div
              v-for="(monster, index) in monsters"
              :key="monster.id"
              class="map-node"
              :class="{
                'completed': index < currentLevel,
                'current': index === currentLevel,
                'upcoming': index > currentLevel
              }"
            >
              <div class="node-connector" v-if="index < monsters.length - 1"></div>
              <div class="monster-card">
                <img :src="monster.image" :alt="monster.name[lang]" class="monster-image" />
                <div class="monster-info">
                  <h4 class="monster-name">{{ monster.name[lang] }}</h4>
                  <div class="monster-status">
                    <span v-if="index < currentLevel" class="status-completed">âœ“ {{ lang === 'es' ? 'Derrotado' : 'Defeated' }}</span>
                    <span v-else-if="index === currentLevel" class="status-current">{{ lang === 'es' ? 'PrÃ³ximo' : 'Next' }}</span>
                    <span v-else class="status-upcoming">{{ lang === 'es' ? 'Bloqueado' : 'Locked' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Player Progress -->
          <div class="player-progress">
            <div class="player-avatar">
              <img :src="selectedCharacter?.image" :alt="selectedCharacter?.name[lang]" class="player-image" />
              <div class="player-level">{{ lang === 'es' ? 'Nivel' : 'Level' }} {{ currentLevel + 1 }}</div>
            </div>
          </div>

          <button class="continue-button" @click="continueToNextLevel">
            {{ lang === 'es' ? 'Continuar Aventura' : 'Continue Adventure' }}
          </button>
        </div>
      </section>

      <template v-else>
      <section class="board" v-if="!(winner==='player' && currentLevel === monsters.length - 1) && !showCredits && !showMapScreen">
        <section id="monster" class="container fighter monster" :class="{'is-hit': isMonsterHit, 'is-active': isMonsterTurn, 'is-critical': isMonsterCritical}">
          <h2>{{ t('monsterHealth') }}</h2>
          <p class="monster-name" v-if="currentMonster">{{ currentMonster.name[lang] }}</p>
          <div class="avatar" aria-hidden="true">
            <div class="avatar-ornate-frame">
              <img :src="monsterImg" alt="monster" class="avatar-img" />
            </div>
            <span class="slash" v-if="slashMonster"></span>
            <span class="slash slash--special" v-if="slashMonsterSpecial"></span>
            <span class="burst burst--special" v-if="burstMonsterSpecial"></span>
            <span class="shockwave" v-if="burstMonsterSpecial"></span>
          </div>
          <div class="healthbar-container">
            <div class="healthbar__value" :style="monsterBarStyles"></div>
          </div>
          <div class="staminabar-container">
            <div class="staminabar__value" :style="{ width: monsterStaminaPercentage + '%' }"></div>
            <div class="stamina-label">{{ lang === 'es' ? 'CARGA' : 'CHARGE' }}</div>
          </div>
        </section>
        <section id="player" class="container fighter player" :class="{'is-hit': isPlayerHit, 'is-defending': isPlayerDefending, 'is-healing': isHealing, 'is-active': !isMonsterTurn, 'is-critical': isPlayerCritical}">
          <h2>{{ t('yourHealth') }}</h2>
          <p class="player-name" v-if="selectedCharacter">{{ selectedCharacter.name[lang] }}</p>
          <div class="avatar" aria-hidden="true">
            <div class="avatar-ornate-frame">
              <img :src="playerImg" alt="player" class="avatar-img" />
            </div>
            <span class="slash slash--enemy" v-if="slashPlayer"></span>
          </div>
          <div class="healthbar-container">
            <div class="healthbar__value" :style="playerBarStyles"></div>
          </div>
          <div class="staminabar-container" :class="{ 'stamina-full': canUseSuperSpecial }">
            <div class="staminabar__value" :style="{ width: playerStaminaPercentage + '%' }"></div>
            <div class="stamina-label">{{ canUseSuperSpecial ? (lang === 'es' ? 'SUPER!' : 'SUPER!') : (lang === 'es' ? 'CARGA' : 'CHARGE') }}</div>
          </div>
        </section>
      </section>
      <div class="center-bubble" v-if="centerBubbleText" :class="centerBubbleClass">{{ centerBubbleText }}</div>
			<!-- Centered Game Result Modal -->
			<div v-if="winner && !showCredits" class="modal-overlay">
				<div class="game-result-modal" role="dialog" aria-modal="true">
					<template v-if="winner === 'player' && currentLevel === monsters.length - 1">
						<h2>{{ t('congratsTitle') }}</h2>
						<p>{{ t('congratsMsg') }}</p>
						<div class="winner-hero" v-if="selectedCharacter">
							<img :src="selectedCharacter.image" :alt="selectedCharacter.name[lang]" class="winner-img" />
							<h3 class="winner-name">{{ selectedCharacter.icon }} {{ selectedCharacter.name[lang] }}</h3>
						</div>
						<div class="win-actions">
							<button @click="goToCredits">Ver crÃ©ditos</button>
							<button @click="goToLanding">{{ t('backToStart') }}</button>
						</div>
					</template>
					<template v-else>
						<h2 v-if="winner==='player' && currentLevel < monsters.length - 1">{{ t('levelCleared') }}</h2>
						<h2 v-else>{{ t('gameOver') }}</h2>
						<template v-if="winner === 'monster'">
							<h3>{{ t('youLost') }}</h3>
							<p class="lives-left">&#10084;&#65039; Ã— {{ lives - 1 >= 0 ? lives - 1 : 0 }}</p>
							<div class="win-actions">
								<button v-if="lives > 1" @click="loseLifeAndRetry()">Reintentar</button>
								<button v-else @click="goToLanding">Volver al inicio</button>
							</div>
						</template>
						<template v-else>
							<h3 v-if="winner === 'player'">{{ t('youWon') }}</h3>
							<h3 v-else>{{ t('draw') }}</h3>
							<div class="win-actions">
								<button v-if="winner==='player' && currentLevel < monsters.length - 1" @click="nextLevel">{{ t('nextLevel') }}</button>
								<button v-else @click="restart">{{ t('startNew') }}</button>
							</div>
						</template>
					</template>
				</div>
			</div>
      <section v-if="showCredits" class="container credits-screen">
        <img src="https://cdn.builder.io/api/v1/image/assets%2Feb9edba76d874a5385833a00b6be2b6e%2F700dab89e83b47b6b1a80c6f00b5f2f7" alt="Credits" class="credits-img" />
        <h2>CrÃ©ditos</h2>
        <p>DiseÃ±o y desarrollo: <a href="https://github.com/deruvodaniel" target="_blank" rel="noopener">Daniel De Ruvo</a></p>
        <p>Gracias por jugar.</p>
        <button @click="goToLanding">Volver al inicio</button>
      </section>
      <div class="turn-wrap" v-if="!winner && !showCredits"><p class="turn-indicator">{{ isMonsterTurn ? t('turnMonster') : t('turnPlayer') }}</p></div>
      <section v-if="!winner && !showCredits" id="controls" :class="{ 'is-locked': controlsDisabled }">
        <button :disabled="controlsDisabled || !canAttack" @click="attackMonster" :data-action="t('attack')">
          <span class="button-icon">ğŸ—¡ï¸</span>
          <span class="button-text">{{ t('attack') }}</span>
        </button>
        <button :disabled="controlsDisabled || mayUseSpecialAttack" @click="specialAttackMonster" :data-action="t('special')">
          <span class="button-icon">ğŸ’¥</span>
          <span class="button-text">{{ t('special') }}</span>
        </button>
        <button :disabled="controlsDisabled || mayUseHeal" @click="healPLayer" :data-action="t('heal')">
          <span class="button-icon">ğŸ’š</span>
          <span class="button-text">{{ t('heal') }}</span>
        </button>
        <button :disabled="controlsDisabled || isPlayerDefending" @click="defend" :data-action="t('defend')">
          <span class="button-icon">ğŸ›¡ï¸</span>
          <span class="button-text">{{ t('defend') }}</span>
        </button>
        <button :disabled="controlsDisabled" @click="surrender" :data-action="t('surrender')">
          <span class="button-icon">ğŸ³ï¸</span>
          <span class="button-text">{{ t('surrender') }}</span>
        </button>
      </section>
      </template>
      <div v-if="showHelp" class="modal-overlay" @click.self="closeHelp">
        <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="help-title">
          <h2 id="help-title" class="modal-title">{{ t('howToPlay') }}</h2>
          <p class="modal-intro">{{ t('rulesIntro') }}</p>
          <ul class="modal-list">
            <li>ğŸ—¡ï¸ {{ t('attack') }} â€” {{ t('rule1') }}</li>
            <li>ğŸ’¥ {{ t('special') }} â€” {{ t('rule2') }}</li>
            <li>ğŸ’š {{ t('heal') }} â€” {{ t('rule3') }}</li>
            <li>ğŸ›¡ï¸ {{ t('defend') }} â€” {{ t('rule4') }}</li>
          </ul>
          <h3 class="modal-title">Controles</h3>
          <ul class="modal-list">
            <li>Turnos: actÃºa cuando diga ï¿½ï¿½ï¿½{{ t('turnPlayer') }}â€.</li>
            <li>Botones principales: {{ t('attack') }}, {{ t('special') }}, {{ t('heal') }}, {{ t('defend') }}, {{ t('surrender') }}.</li>
            <li>Idioma/Tema/Sonido: usa los botones de la cabecera.</li>
            <li>Vidas: tienes {{ maxLives }} intentos por partida.</li>
            <li>Avance: derrota al monstruo para pasar de nivel.</li>
          </ul>
          <button class="icon-button" @click="closeHelp">{{ t('close') }}</button>
        </div>
      </div>

      <!-- User Menu Modal -->
      <div v-if="showUserMenu" class="modal-overlay" @click.self="closeUserMenu">
        <div class="user-menu-dialog" role="dialog" aria-modal="true">
          <div class="user-menu-header">
            <h2 class="user-menu-title">{{ lang === 'es' ? 'Perfil de Usuario' : 'User Profile' }}</h2>
            <button class="close-button" @click="closeUserMenu" :aria-label="lang === 'es' ? 'Cerrar' : 'Close'">Ã—</button>
          </div>

          <div class="user-menu-content">
            <!-- Avatar and Stats -->
            <div class="user-stats-section">
              <div class="user-avatar-large">
                <img v-if="selectedCharacter" :src="selectedCharacter.image" :alt="selectedCharacter.name[lang]" class="user-avatar-img" />
                <div class="user-level-badge">{{ lang === 'es' ? 'Nivel' : 'Level' }} {{ currentLevel + 1 }}</div>
              </div>

              <div class="user-stats">
                <div class="stat-item">
                  <span class="stat-label">{{ lang === 'es' ? 'Monedas:' : 'Coins:' }}</span>
                  <span class="stat-value numeric">ğŸª™ {{ playerCoins }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">{{ lang === 'es' ? 'Monstruos derrotados:' : 'Monsters defeated:' }}</span>
                  <span class="stat-value numeric">{{ currentLevel }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">{{ lang === 'es' ? 'Vidas restantes:' : 'Lives remaining:' }}</span>
                  <span class="stat-value numeric">â¤ï¸ {{ lives }}</span>
                </div>
              </div>
            </div>

            <!-- Name Editor -->
            <div class="name-editor-section">
              <h3 class="section-title">{{ lang === 'es' ? 'Editar Nombre' : 'Edit Name' }}</h3>
              <div class="name-editor">
                <input
                  type="text"
                  v-model="editingName"
                  maxlength="10"
                  class="edit-name-input"
                  :placeholder="lang === 'es' ? 'Nuevo nombre...' : 'New name...'"
                />
                <button class="save-name-button" @click="saveName" :disabled="!editingName.trim() || editingName.trim() === playerName">
                  {{ lang === 'es' ? 'Guardar' : 'Save' }}
                </button>
              </div>
            </div>

            <!-- Character Selector -->
            <div class="character-editor-section">
              <h3 class="section-title">{{ lang === 'es' ? 'Cambiar Personaje' : 'Change Character' }}</h3>
              <div class="characters-grid-small">
                <button
                  v-for="char in characters"
                  :key="char.id"
                  type="button"
                  class="character-card-small"
                  :class="{ 'is-selected': selectedCharacterId === char.id }"
                  @click="selectNewCharacter(char.id)"
                >
                  <img :src="char.image" :alt="char.name[lang]" class="char-img-small" />
                  <div class="char-info-small">
                    <div class="char-name-small">{{ char.icon }} {{ char.name[lang] }}</div>
                    <div class="char-stats-small">
                      <span>âš”ï¸ {{ char.stats.attack }}</span>
                      <span>ğŸ›¡ï¸ {{ char.stats.defend }}</span>
                      <span>ğŸ’š {{ char.stats.heal }}</span>
                      <span>ğŸ’¥ {{ char.stats.special }}</span>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Welcome Modal with Rules -->
      <div v-if="showWelcomeModal" class="modal-overlay">
        <div class="welcome-modal-dialog" role="dialog" aria-modal="true">
          <h2 class="welcome-modal-title">{{ t('welcome') }}</h2>
          <p class="welcome-modal-intro">{{ t('welcomeMsg') }}</p>

          <!-- Name Input -->
          <div class="name-input-section">
            <label for="playerNameInput" class="name-label">{{ lang === 'es' ? 'Ingresa tu nombre:' : 'Enter your name:' }}</label>
            <input
              id="playerNameInput"
              type="text"
              v-model="playerName"
              maxlength="10"
              class="name-input"
              :placeholder="lang === 'es' ? 'Tu nombre...' : 'Your name...'"
            />
          </div>

          <div class="welcome-rules">
            <h3 class="rules-title">{{ t('howToPlay') }}</h3>
            <p class="modal-intro">{{ t('rulesIntro') }}</p>
            <ul class="modal-list">
              <li>ğŸ—¡ï¸ {{ t('attack') }} â€” {{ t('rule1') }}</li>
              <li>ğŸ’¥ {{ t('special') }} â€” {{ t('rule2') }}</li>
              <li>ğŸ’š {{ t('heal') }} â€” {{ t('rule3') }}</li>
              <li>ï¿½ï¿½ï¿½ï¸ {{ t('defend') }} â€” {{ t('rule4') }}</li>
            </ul>
          </div>

          <button class="welcome-play-button" @click="closeWelcomeModal" :disabled="!playerName.trim()">
            <span class="play-icon">ğŸ®</span>
            <span class="play-text">{{ t('start') }}</span>
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
